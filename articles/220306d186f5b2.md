---
title: "新卒研修で触ったクエリ文②"
emoji: "💾"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["SQL"]
published: true
---

[新卒研修で触ったクエリ文①](https://zenn.dev/minami_hiroto/articles/be6c2121ac571e)

# 実務

## トランザクション
ほぼ必須
```sql
//途中でエラーが起こらない限り処理を一括して行なってくれる
//もし処理中エラーが起こった場合、トランザクションの処理をしてなかったことにしてくれる👉ROLLBACK
BEGIN; //トランザクション開始
INSERT INTO データ SELECT * FROM テーブル WHERE 条件; //👉成功
DELETE FROM テーブル WHERE 条件;//👉失敗、成功した上記を無かったことにしてくれる👉ROLLBACK
COMMIT; //トランザクション終了
//自動でROLLBACKを行うが、明示的に表示することもできる
//トランザクションは"完全に成功した結果"or"処理が走ってなかったことにする"かの2択しか返さない
```

# 応用

## テーブルの結合
テーブルとテーブルを結合させてからデータを取得するやり方
[SQL素人でも分かるテーブル結合(inner joinとouter join)](https://zenn.dev/naoki_mochizuki/articles/60603b2cdc273cd51c59)👈 詳しくはこちらの超優良記事を参考にしてください

```SQL
//内部結合、INNERは省略可能
//片方のテーブルにNULLのカラムがある場合そのデータは取得しない
//条件は テーブル1.PK 条件(=,<=,!=など) テーブル2.FK という書き方をする
//条件がないと意図した結びつき方をしない
SELECT * FROM テーブル1
JOIN テーブル2 ON 条件

//外部結合、OUTERは省略可能
//LEFTで左テーブルを基準テーブルに、RIGHTで右テーブルを基準テーブルに
//基準テーブルのNULLカラムのデータを取得し、基準でないテーブルのNULLカラムは取得しない
SELECT * FROM テーブル1
LEFT(RIGHT) JOIN テーブル2 ON 条件
```


## サブクエリ
```sql
//テーブル内の、カラム１の中で、(全てのカラム1の平均より下)のカラム1,カラム2を抽出
SELECT カラム1,カラム2
FROM テーブル　AS テーブル１ //テーブルに別名をつけてテーブル2との違いを出してる
WHERE テーブル1.カラム1 < (SELECT AVG(カラム1) AS 平均カラム //カッコ内がサブクエリ
                   　　FROM テーブル AS テーブル2 //テーブルに別名をつける、上記理由と同じ
                  　　 WHERE テーブル1.カラム2 = テーブル2.カラム2);　//条件
		     //条件はWHEREだから先に行われる👉処理順序
		     //テーブル1をサブ(子)クエリ内で出している👉相関サブクエリ
		     //もし親クエリ関係なくサブクエリ内で完結してるいると非相関サブクエリになる
```